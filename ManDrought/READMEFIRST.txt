Make sure to edit dat.r to provide the locations of your CSV file and your GIS data.

GIS data is available from http://www.stats.govt.nz/browse_for_stats/people_and_communities/Geographic-areas/digital-boundary-files.aspx

Not tested to see if this code works with CSV files that are not of the format provided.
